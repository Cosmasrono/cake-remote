generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  email     String   @unique
  password  String
  role      UserRole   @default(USER) // Changed to use UserRole enum
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  Enrollment Enrollment[]
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

model Cake {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  type      String
  price     Float
  image     String
  rating    Int      @default(5)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Cart {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  cakeName  String
  cakeType  String
  price     Float
  image     String
  quantity  Int      @default(1)
  createdAt DateTime @default(now())
}

model Order {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  cakeName  String
  cakeType  String
  createdAt DateTime @default(now())
}

model Course {
  id           String       @id @default(auto()) @map("_id") @db.ObjectId
  title        String
  description  String
  level        String
  price        Float
  image        String?
  whatsappLink String?      // Add this line
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  enrollments  Enrollment[]
}

enum EnrollmentStatus {
  PENDING
  APPROVED
  REJECTED
  COMPLETED
  CANCELLED
}

model Enrollment {
  id          String           @id @default(auto()) @map("_id") @db.ObjectId
  userId      String           @db.ObjectId
  user        User             @relation(fields: [userId], references: [id])
  courseId    String           @db.ObjectId
  course      Course           @relation(fields: [courseId], references: [id])
  email       String?
  name        String?
  phoneNumber String?
  status      EnrollmentStatus @default(PENDING)
  enrolledAt  DateTime         @default(now())
  paymentInfo String? // Placeholder for payment gateway transaction ID or similar
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
}

model Payment {
  id                  String        @id @default(auto()) @map("_id") @db.ObjectId
  merchantRequestId   String
  checkoutRequestId   String        @unique
  phoneNumber         String
  amount              Float
  status              PaymentStatus @default(PENDING)
  resultCode          Int?
  resultDesc          String?
  mpesaReceiptNumber  String?
  transactionDate     String?
  cartItems           Json?         // Store cart items
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
}


model CustomOrder {
  id              String   @id @default(cuid()) @map("_id") // This is the fix
  name            String
  phone           String
  occasion        String?
  date            String?
  flavor          String?
  size            String?
  message         String?
  inspirationLink String?
  image           String?
  status          String   @default("pending")
  createdAt       DateTime @default(now())

  @@map("custom_orders") // optional: rename collection name
}


model Promotion {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  message   String
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@map("promotions")
}